---
title: "Group Project 1"
subtitle: "Biology 368/664 Bucknell University"
output: pdf_document
authors: Prof. Ken Field
date: 14 Sep 2024
---

```{r Load Libraries, include=FALSE}
# Load other packages here.
if (!require("tidyverse")) install.packages("tidyverse"); library(tidyverse)
if (!require("MASS")) install.packages("MASS"); library(MASS)
if (!require("cowplot")) install.packages("cowplot"); library(cowplot)
if (!require("multcomp")) install.packages("multcomp"); library(multcomp) # for more accurate p
if (!require("emmeans")) install.packages("emmeans"); library(emmeans) # for more accurate p
if (!require("conflicted")) install.packages("conflicted"); library(conflicted) # For dealing with conflicts
conflict_prefer_all("dplyr", quiet = TRUE)
```


```{r}
#Reading in the built in dataset from R
(esoph)
write.csv(esoph, "Esoph.scancer.csv", row.names = FALSE)
Esoph_scancer <- read.csv("Esoph.scancer.csv")
```


```{r}
#Converting to factors
Esoph_scancer$agegp<- as.factor(Esoph_scancer$agegp)
Esoph_scancer$alcgp<- as.factor(Esoph_scancer$alcgp)
Esoph_scancer$tobgp<- as.factor(Esoph_scancer$tobgp)
```

Preliminary hypothesis testing:
###Creating a hypothesis:
When creating a hypothesis, it is important to not look at the results first as this could lead to “harking” or formulating a “hypothesis after the results are known.” When first looking at our dataset (“esoph” from the built-in R datasets, holds data for the age of subjects, alcohol intake, tobacco intake, number of esophageal cancer cases, and number of controls), we looked at the variables without checking for normality of the data or graphing/testing our results. There were three variables that stood out to us: alcohol intake, tobacco intake, and number of esophageal cancer cases. This led us to formulating the following hypothesis:

Groups that smoke/drink more may have a higher risk of developing esophageal cancer. The number of cases may also increase with age. 

Variables:
Tobacco per day (g) - ordinal, categorical
Alcohol per day (g) - ordinal, categorical
Age (grouped into ranges of age) - ordinal, categorical
Number of cases (numerical values that can be counted) - discrete, quantitative

As a first look for comparisons, we can calculate the mean of each of the groups individually to determine which groups had the highest number of cases. This can be done using the following function:

```{r}
#Finding the mean number of cases for each individual group without looking into other variables
mean_age_group <- Esoph_scancer |> 
  group_by(agegp) |> 
  summarize(mean_value = mean(ncases, na.rm = TRUE))
mean_age_group

mean_alc_group <- Esoph_scancer |> 
  group_by(alcgp) |> 
  summarize(mean_value = mean(ncases, na.rm = TRUE))
mean_alc_group

mean_tob_group <- Esoph_scancer |> 
  group_by(tobgp) |> 
  summarize(mean_value = mean(ncases, na.rm = TRUE))
mean_tob_group

```

The following can be done to order the ranking by number of cases just to see which groups had the highest number of cases and which groups had the lowest number of cases.

```{r}
ranking <- Esoph_scancer |>
  arrange(desc(ncases), .by_group = TRUE) 
ranking
```
```{r}
head(ranking)
tail(ranking)
```
The above functions and results give us a first look into each variable or group separately, however, this doesn’t take into account all of the factors together, so the results of this would not be reliable enough to make any conclusions. 

###Creating a linear model:

```{r}
lm1<-lm(ncases ~ agegp * (alcgp + tobgp), data=Esoph_scancer) 
summary(lm1)
```
The overall p-value for this linear model is extremely small, showing that there is a significant relationship between each of the variables on number of cases. 

In order to use a linear model, there are a few assumptions that must be followed relating to the residuals. These include the following:
1) Independence of data points
2) Normally distributed residuals
3) Homoscedastic data

```{r}
install.packages(lmtest); library(lmtest)
dwtest(lm1)
```

```{r}
hist(lm1$residuals)
```
```{r}
plot(lm1)
```

```{r}
anova(lm1)
```
This linear model yields many results as it shows the significance of each group (tobacco and alcohol intake). It shows that the results are significant for all of the groups except for age group correlated with tobacco group. 

######

```{r}
#testing for normality in the data
library(ggplot2)
library(cowplot)
a <- ggplot(Esoph_scancer, aes(x=tobgp)) + geom_bar() + ggtitle("Tobacco Group")
b <- ggplot(Esoph_scancer, aes(x=alcgp)) + geom_bar() + ggtitle("Alcohol Group")
c <- ggplot(Esoph_scancer, aes(x=agegp)) + geom_bar() + ggtitle("Age Group")

# Display the plots in a grid
plot_grid(a, b, c, ncol = 2)
```


#Making a histogram of the orginal and log transformed data and making density plots of them
```{r} 
# Create bar plots for discrete variables
a <- ggplot(Esoph_scancer, aes(x=tobgp)) + geom_bar() + ggtitle("Tobacco Group - Bar Plot")
b <- ggplot(Esoph_scancer, aes(x=alcgp)) + geom_bar() + ggtitle("Alcohol Group - Bar Plot")

# Create density plots using continuous data (if needed)
# Assuming there is a continuous variable, for example, ncases
# If not, density plots may not be applicable to this dataset

# For demonstration, let's assume a continuous variable ncases exists
c <- ggplot(Esoph_scancer, aes(x=ncases)) + geom_density() + ggtitle("Density Plot - ncases")
d <- ggplot(Esoph_scancer, aes(x=log(ncases))) + geom_density() + ggtitle("Density Plot - log(ncases)")

# Plot in a 2x2 grid
plot_grid(a, b, c, d, ncol = 2, nrow = 2)
```

```{r}
a<-qplot(data = Esoph_scancer,
         x=alcgp,
         geom = "histogram",
         bins=8)
b<-qplot(data = Esoph_scancer,
         x=log(alcgp),
         geom = "histogram",
         bins=8)
c<-qplot(data = Esoph_scancer,
         x=alcgp,
         geom = "density")
d<-qplot(data = Esoph_scancer,
         x=log(alcgp),
         geom = "density")
#Plot in a 2X2 grid

plot_grid(a,b,c,d, ncol = 2, nrow = 2)
```


###Data Visualization
Data visualization is another important aspect of data analysis because it allows you to simplify the data in a way that is easily digestible but still keep the importance of the findings. Another important reason to visualize the data is that most times, you will be presenting your findings to other people. There's also a good chance that your audience isn't as familiar with looking at data like you are so visuals are the best way to showcase your work.

Depending on the type of variables you are using, the kind of plot you will want to use will be different. For example, if you are comparing a quantitative variable with a categorical one, the type of visuals you will wabt to use includes bar charts, boxplots, or pie charts. If you are comparing a quantitative variable to another quantitative variable, the type of graphs you will want to use includes a scatterplot or a line graph. Finally, in rare cases(such as this one) comparing two categorical variables you will want use a mosaic plot.

Our data set only uses categorical variables so we will be using a mosaic plot along with some bar charts we used above.

```{r - Data Visualization}
require(stats)
require(graphics) # for mosaicplot
summary(esoph)
## effects of alcohol, tobacco and interaction, age-adjusted
model1 <- glm(cbind(ncases, ncontrols) ~ agegp + tobgp * alcgp,
              data = esoph, family = binomial())
anova(model1)
## Try a linear effect of alcohol and tobacco
model2 <- glm(cbind(ncases, ncontrols) ~ agegp + unclass(tobgp)
                                         + unclass(alcgp),
              data = esoph, family = binomial())
summary(model2)
## Re-arrange data for a mosaic plot
ttt <- table(esoph$agegp, esoph$alcgp, esoph$tobgp)
o <- with(esoph, order(tobgp, alcgp, agegp))
ttt[ttt == 1] <- esoph$ncases[o]
tt1 <- table(esoph$agegp, esoph$alcgp, esoph$tobgp)
tt1[tt1 == 1] <- esoph$ncontrols[o]
tt <- array(c(ttt, tt1), c(dim(ttt),2),
            c(dimnames(ttt), list(c("Cancer", "control"))))
mosaicplot(tt, main = "esoph data set", color = TRUE)
```

By making a mosaic plot we can see that there are more cancer cases in older age groups that consume bother tobacco and alcohol compared to the lower age group and the groups that consume either a very low amount of each substance or none at all. The ANOVA test we performed alongside it also tell us the signnificance of each of our groups.